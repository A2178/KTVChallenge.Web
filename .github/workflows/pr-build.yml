name: PR Build & Test (.NET)

on:
  pull_request:
    branches: [ "main", "master" ]   # PR 目標分支
  push:
    branches: [ "feature/**", "fix/**" ]  # 可選：開發分支也跑一次

jobs:
  build:
    runs-on: windows-latest  # Blazor/ASP.NET Core 用 Windows 最省心（Linux 也可）
    timeout-minutes: 20

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          lfs: true   # 你的音檔若用 Git LFS，這行要留著

      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'
          cache: true   # 快取 NuGet

      - name: Restore
        run: dotnet restore

      - name: Build
        run: dotnet build --configuration Release --no-restore

      - name: Test
        run: dotnet test --configuration Release --no-build --verbosity normal

      # 可選：把可部署輸出打包成 artifact 讓你下載驗證
      - name: Publish Web (artifact)
        run: dotnet publish KTVChallenge.Web/KTVChallenge.Web.csproj -c Release -o ./publish /p:PublishSingleFile=false /p:SelfContained=false

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: ktv-publish
          path: ./publish
          if-no-files-found: warn
